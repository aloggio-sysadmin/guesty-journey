/* ─── Chat page layout ────────────────────────────────────────── */
.chat-page{display:flex;flex-direction:column;height:100vh;overflow:hidden}
.chat-header{display:flex;align-items:center;gap:16px;padding:12px 20px;background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0}
.chat-header-info{flex:1;min-width:0}
.chat-header-info h3{font-size:15px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.chat-header-meta{font-size:12px;color:var(--text-secondary);margin-top:2px}
.chat-progress{display:flex;align-items:center;gap:8px;min-width:160px}
.chat-progress-bar{flex:1;height:4px;background:var(--border);border-radius:2px;overflow:hidden}
.chat-progress-bar-fill{height:100%;background:var(--primary);border-radius:2px;transition:width 0.4s ease}
.chat-progress span{font-size:12px;font-weight:600;color:var(--primary);white-space:nowrap}
.chat-body{display:flex;flex:1;overflow:hidden}
.chat-messages-area{flex:1;display:flex;flex-direction:column;overflow:hidden}
.chat-messages{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:16px}
.chat-messages::-webkit-scrollbar{width:4px}
.chat-messages::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}

/* ─── Message bubbles ─────────────────────────────────────────── */
.msg-row{display:flex;gap:10px;max-width:100%}
.msg-row.user{flex-direction:row-reverse}
.msg-avatar{width:32px;height:32px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:14px;margin-top:2px}
.msg-avatar.agent{background:var(--primary);color:#fff}
.msg-avatar.user{background:var(--secondary);color:#fff}
.msg-bubble{max-width:75%;padding:12px 16px;border-radius:var(--radius-bubble);line-height:1.5;font-size:14px;white-space:pre-wrap;word-break:break-word}
.msg-row.agent .msg-bubble{background:var(--agent-bubble);color:var(--text-primary);border-bottom-left-radius:4px}
.msg-row.user  .msg-bubble{background:var(--user-bubble);color:#fff;border-bottom-right-radius:4px}
.msg-time{font-size:11px;color:var(--text-secondary);margin-top:4px;padding:0 4px}
.msg-row.user .msg-time{text-align:right}

/* ─── Extraction & conflict blocks inside messages ────────────── */
.extraction-block{background:#ECFDF5;border-left:3px solid var(--secondary);border-radius:4px;padding:8px 12px;margin:8px 0;font-size:13px}
.extraction-block .block-label{font-size:11px;font-weight:700;color:var(--secondary);text-transform:uppercase;letter-spacing:0.04em;margin-bottom:4px}
.conflict-block{background:#FEF3C7;border-left:3px solid var(--warning);border-radius:4px;padding:8px 12px;margin:8px 0;font-size:13px}
.conflict-block .block-label{font-size:11px;font-weight:700;color:var(--warning);text-transform:uppercase;letter-spacing:0.04em;margin-bottom:4px}
.block-item{display:flex;align-items:flex-start;gap:6px;margin:2px 0}
.block-item::before{content:"•";flex-shrink:0;margin-top:1px}

/* ─── Typing indicator ────────────────────────────────────────── */
.typing-indicator{display:flex;align-items:center;gap:4px;padding:12px 16px;background:var(--agent-bubble);border-radius:var(--radius-bubble);border-bottom-left-radius:4px;width:fit-content}
.typing-dot{width:6px;height:6px;background:var(--text-secondary);border-radius:50%;animation:bounce 1.2s infinite}
.typing-dot:nth-child(2){animation-delay:0.2s}
.typing-dot:nth-child(3){animation-delay:0.4s}
@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-6px)}}

/* ─── Input bar ───────────────────────────────────────────────── */
.chat-input-area{border-top:1px solid var(--border);background:var(--surface);padding:12px 16px;flex-shrink:0}
.chat-quick-actions{display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap}
.quick-btn{padding:4px 12px;border-radius:999px;font-size:12px;font-weight:500;background:var(--bg);color:var(--text-secondary);border:1px solid var(--border);cursor:pointer;transition:var(--transition)}
.quick-btn:hover{background:var(--primary);color:#fff;border-color:var(--primary)}
.chat-input-row{display:flex;gap:8px;align-items:flex-end}
.chat-textarea{flex:1;resize:none;border:1px solid var(--border);border-radius:var(--radius-btn);padding:10px 14px;font-size:14px;line-height:1.4;min-height:42px;max-height:120px;overflow-y:auto;transition:var(--transition)}
.chat-textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,0.1)}
.chat-send-btn{padding:10px 16px;background:var(--primary);color:#fff;border-radius:var(--radius-btn);font-size:14px;font-weight:500;flex-shrink:0;transition:var(--transition)}
.chat-send-btn:hover{background:var(--primary-dark)}
.chat-send-btn:disabled{opacity:0.5;cursor:not-allowed}

/* ─── Side panel ──────────────────────────────────────────────── */
.chat-side-panel{width:280px;border-left:1px solid var(--border);background:var(--surface);overflow-y:auto;flex-shrink:0;transition:var(--transition)}
.side-panel-section{padding:16px;border-bottom:1px solid var(--border)}
.side-panel-section h4{font-size:12px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.04em;margin-bottom:10px}
.record-counts{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.record-count-item{background:var(--bg);border-radius:6px;padding:8px;text-align:center}
.record-count-item .count{font-size:20px;font-weight:700;color:var(--primary)}
.record-count-item .label{font-size:11px;color:var(--text-secondary);margin-top:2px}
.stage-checklist{list-style:none}
.stage-item{display:flex;align-items:center;gap:8px;padding:5px 0;font-size:13px}
.stage-item .stage-icon{width:18px;height:18px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0}
.stage-item.done .stage-icon{background:var(--secondary);border-color:var(--secondary);color:#fff}
.stage-item.active .stage-icon{border-color:var(--primary);background:rgba(37,99,235,0.1)}
.stage-item.active{color:var(--primary);font-weight:600}
.question-item{font-size:12px;padding:6px 0;border-bottom:1px solid var(--border);color:var(--text-secondary)}
.question-item:last-child{border-bottom:none}

/* ─── Side panel toggle for mobile ───────────────────────────── */
.side-panel-toggle{display:none;position:absolute;top:60px;right:12px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-btn);padding:6px 10px;font-size:12px;cursor:pointer;box-shadow:var(--shadow-card)}
@media(max-width:768px){
  .chat-side-panel{display:none;position:fixed;top:0;right:0;height:100vh;z-index:150;box-shadow:var(--shadow-modal)}
  .chat-side-panel.open{display:block}
  .side-panel-toggle{display:block}
  .msg-bubble{max-width:90%}
}

/* ─── Print styles for report viewer ─────────────────────────── */
@media print{
  #sidebar,.chat-input-area,.chat-header,.quick-btn,.btn{display:none!important}
  body{background:#fff}
}
